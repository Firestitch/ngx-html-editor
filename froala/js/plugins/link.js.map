/*!
 * froala_editor v3.2.1 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2020 Froala Labs
 */

{"version":3,"file":"link.js","sources":["../../../src/js/plugins/link.js"],"sourcesContent":["import FE from '../index.js'\r\n'use strict';\r\n\r\nObject.assign(FE.POPUP_TEMPLATES, {\r\n  'link.edit': '[_BUTTONS_]',\r\n  'link.insert': '[_BUTTONS_][_INPUT_LAYER_]'\r\n})\r\n\r\n// Extend defaults.\r\nObject.assign(FE.DEFAULTS, {\r\n  linkEditButtons: ['linkOpen', 'linkStyle', 'linkEdit', 'linkRemove'],\r\n  linkInsertButtons: ['linkBack', '|', 'linkList'],\r\n  linkAttributes: {},\r\n  linkAutoPrefix: 'http://',\r\n  linkStyles: {\r\n    'fr-green': 'Green',\r\n    'fr-strong': 'Thick'\r\n  },\r\n  linkMultipleStyles: true,\r\n  linkConvertEmailAddress: true,\r\n  linkAlwaysBlank: false,\r\n  linkAlwaysNoFollow: false,\r\n  linkNoOpener: true,\r\n  linkNoReferrer: true,\r\n  linkList: [\r\n    {\r\n      text: 'Froala',\r\n      href: 'https://froala.com',\r\n      target: '_blank'\r\n    },\r\n    {\r\n      text: 'Google',\r\n      href: 'https://google.com',\r\n      target: '_blank'\r\n    },\r\n    {\r\n      displayText: 'Facebook',\r\n      href: 'https://facebook.com'\r\n    }\r\n  ],\r\n  linkText: true\r\n})\r\n\r\nFE.PLUGINS.link = function (editor) {\r\n\r\n  const { $ } = editor\r\n\r\n  function get() {\r\n    const $current_image = editor.image ? editor.image.get() : null \r\n\r\n    if (!$current_image && editor.$wp) {\r\n      let c_el = editor.selection.ranges(0).commonAncestorContainer \r\n\r\n      try {\r\n        if (c_el && ((c_el.contains && c_el.contains(editor.el)) || !editor.el.contains(c_el) || editor.el == c_el)) c_el = null \r\n      }\r\n      catch (ex) {\r\n        c_el = null \r\n      }\r\n\r\n      if (c_el && c_el.tagName === 'A') return c_el \r\n      let s_el = editor.selection.element() \r\n      let e_el = editor.selection.endElement() \r\n\r\n      if (s_el.tagName != 'A' && !editor.node.isElement(s_el)) {\r\n        s_el = $(s_el).parentsUntil(editor.$el, 'a').first().get(0) \r\n      }\r\n\r\n      if (e_el.tagName != 'A' && !editor.node.isElement(e_el)) {\r\n        e_el = $(e_el).parentsUntil(editor.$el, 'a').first().get(0) \r\n      }\r\n\r\n      try {\r\n        if (e_el && ((e_el.contains && e_el.contains(editor.el)) || !editor.el.contains(e_el) || editor.el == e_el)) e_el = null \r\n      }\r\n      catch (ex) {\r\n        e_el = null \r\n      }\r\n\r\n      try {\r\n        if (s_el && ((s_el.contains && s_el.contains(editor.el)) || !editor.el.contains(s_el) || editor.el == s_el)) s_el = null \r\n      }\r\n      catch (ex) {\r\n        s_el = null \r\n      }\r\n\r\n      if (e_el && e_el == s_el && e_el.tagName == 'A') {\r\n\r\n        // We do not clicking at the end / input of links because in IE the selection is changing shortly after mouseup.\r\n        // https://jsfiddle.net/jredzam3/\r\n        if ((editor.browser.msie || editor.helpers.isMobile()) && (editor.selection.info(s_el).atEnd || editor.selection.info(s_el).atStart)) {\r\n          return null \r\n        }\r\n\r\n        return s_el \r\n      }\r\n\r\n      return null \r\n    }\r\n    else if (editor.el.tagName == 'A') {\r\n\r\n      return editor.el \r\n    }\r\n    else {\r\n      if ($current_image && $current_image.get(0).parentNode && $current_image.get(0).parentNode.tagName == 'A') {\r\n\r\n        return $current_image.get(0).parentNode \r\n      }\r\n    }\r\n  }\r\n\r\n  function allSelected() {\r\n    const $current_image = editor.image ? editor.image.get() : null \r\n    const selectedLinks = [] \r\n\r\n    if ($current_image) {\r\n      if ($current_image.get(0).parentNode.tagName == 'A') {\r\n        selectedLinks.push($current_image.get(0).parentNode) \r\n      }\r\n    }\r\n    else {\r\n      let range \r\n      let containerEl \r\n      let links \r\n      let linkRange \r\n\r\n      if (editor.win.getSelection) {\r\n        const sel = editor.win.getSelection() \r\n\r\n        if (sel.getRangeAt && sel.rangeCount) {\r\n          linkRange = editor.doc.createRange() \r\n\r\n          for (let r = 0; r < sel.rangeCount; ++r) {\r\n            range = sel.getRangeAt(r) \r\n            containerEl = range.commonAncestorContainer \r\n\r\n            if (containerEl && containerEl.nodeType != 1) {\r\n              containerEl = containerEl.parentNode \r\n            }\r\n\r\n            if (containerEl && containerEl.nodeName.toLowerCase() == 'a') {\r\n              selectedLinks.push(containerEl) \r\n            }\r\n            else {\r\n              links = containerEl.getElementsByTagName('a') \r\n\r\n              for (let i = 0; i < links.length; ++i) {\r\n                linkRange.selectNodeContents(links[i]) \r\n\r\n                if (linkRange.compareBoundaryPoints(range.END_TO_START, range) < 1 && linkRange.compareBoundaryPoints(range.START_TO_END, range) > -1) {\r\n                  selectedLinks.push(links[i]) \r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          // linkRange.detach() \r\n        }\r\n      }\r\n      else if (editor.doc.selection && editor.doc.selection.type != 'Control') {\r\n        range = editor.doc.selection.createRange() \r\n        containerEl = range.parentElement() \r\n\r\n        if (containerEl.nodeName.toLowerCase() == 'a') {\r\n          selectedLinks.push(containerEl) \r\n        }\r\n        else {\r\n          links = containerEl.getElementsByTagName('a') \r\n          linkRange = editor.doc.body.createTextRange() \r\n\r\n          for (let j = 0; j < links.length; ++j) {\r\n            linkRange.moveToElementText(links[j]) \r\n\r\n            if (linkRange.compareEndPoints('StartToEnd', range) > -1 && linkRange.compareEndPoints('EndToStart', range) < 1) {\r\n              selectedLinks.push(links[j]) \r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return selectedLinks \r\n  }\r\n\r\n  function _edit(e) {\r\n    if (editor.core.hasFocus()) {\r\n      _hideEditPopup() \r\n\r\n      // Do not show edit popup for link when ALT is hit.\r\n      if (e && e.type === 'keyup' && (e.altKey || e.which == FE.KEYCODE.ALT)) return true \r\n\r\n      setTimeout(function () {\r\n\r\n        // No event passed.\r\n        // Event passed and (left click or other event type).\r\n        if (!e || (e && (e.which == 1 || e.type != 'mouseup'))) {\r\n          const link = get() \r\n          const $current_image = editor.image ? editor.image.get() : null \r\n\r\n          if (link && !$current_image) {\r\n            if (editor.image) {\r\n              const contents = editor.node.contents(link) \r\n\r\n              // https://github.com/froala/wysiwyg-editor/issues/1103\r\n              if (contents.length == 1 && contents[0].tagName == 'IMG') {\r\n                const range = editor.selection.ranges(0) \r\n\r\n                if (range.startOffset === 0 && range.endOffset === 0) {\r\n                  $(link).before(FE.MARKERS) \r\n                }\r\n                else {\r\n                  $(link).after(FE.MARKERS) \r\n                }\r\n\r\n                editor.selection.restore() \r\n\r\n                return false \r\n              }\r\n            }\r\n\r\n            if (e) {\r\n              e.stopPropagation() \r\n            }\r\n            _showEditPopup(link) \r\n          }\r\n        }\r\n      }, editor.helpers.isIOS() ? 100 : 0) \r\n    }\r\n  }\r\n\r\n  function _showEditPopup(link) {\r\n    let $popup = editor.popups.get('link.edit') \r\n\r\n    if (!$popup) $popup = _initEditPopup() \r\n\r\n    const $link = $(link) \r\n\r\n    if (!editor.popups.isVisible('link.edit')) {\r\n      editor.popups.refresh('link.edit') \r\n    }\r\n    editor.popups.setContainer('link.edit', editor.$sc) \r\n    const left = $link.offset().left + $link.outerWidth() / 2\r\n    const top = $link.offset().top + $link.outerHeight()\r\n\r\n    editor.popups.show('link.edit', left, top, $link.outerHeight(), true) \r\n  }\r\n\r\n  function _hideEditPopup() {\r\n    editor.popups.hide('link.edit') \r\n  }\r\n\r\n  function _initEditPopup() {\r\n\r\n    // Link buttons.\r\n    let link_buttons = '' \r\n\r\n    if (editor.opts.linkEditButtons.length >= 1) {\r\n      if (editor.el.tagName == 'A' && editor.opts.linkEditButtons.indexOf('linkRemove') >= 0) {\r\n        editor.opts.linkEditButtons.splice(editor.opts.linkEditButtons.indexOf('linkRemove'), 1) \r\n      }\r\n\r\n      link_buttons = `<div class=\"fr-buttons\">${editor.button.buildList(editor.opts.linkEditButtons)}</div>` \r\n    }\r\n\r\n    const template = {\r\n      buttons: link_buttons\r\n    } \r\n\r\n    // Set the template in the popup.\r\n    const $popup = editor.popups.create('link.edit', template) \r\n\r\n    if (editor.$wp) {\r\n      editor.events.$on(editor.$wp, 'scroll.link-edit', function () {\r\n        if (get() && editor.popups.isVisible('link.edit')) {\r\n          _showEditPopup(get()) \r\n        }\r\n      }) \r\n    }\r\n\r\n    return $popup \r\n  }\r\n\r\n  /**\r\n   * Hide link insert popup.\r\n   */\r\n  function _refreshInsertPopup() {\r\n    const $popup = editor.popups.get('link.insert') \r\n    const link = get() \r\n\r\n    if (link) {\r\n      const $link = $(link) \r\n      const text_inputs = $popup.find('input.fr-link-attr[type=\"text\"]') \r\n      const check_inputs = $popup.find('input.fr-link-attr[type=\"checkbox\"]') \r\n      let i \r\n      let $input \r\n\r\n      for (i = 0; i < text_inputs.length; i++) {\r\n        $input = $(text_inputs[i]) \r\n        $input.val($link.attr($input.attr('name') || '')) \r\n      }\r\n\r\n      check_inputs.attr('checked', false) \r\n\r\n      for (i = 0; i < check_inputs.length; i++) {\r\n        $input = $(check_inputs[i]) \r\n\r\n        if ($link.attr($input.attr('name')) == $input.data('checked')) {\r\n          $input.attr('checked', true) \r\n        }\r\n      }\r\n\r\n      $popup.find('input.fr-link-attr[type=\"text\"][name=\"text\"]').val($link.text()) \r\n    }\r\n    else {\r\n      $popup.find('input.fr-link-attr[type=\"text\"]').val('') \r\n      $popup.find('input.fr-link-attr[type=\"checkbox\"]').attr('checked', false)\r\n      $popup.find('input.fr-link-attr[type=\"text\"][name=\"text\"]').val(editor.selection.text()) \r\n    }\r\n    $popup.find('input.fr-link-attr').trigger('change') \r\n    const $current_image = editor.image ? editor.image.get() : null \r\n\r\n    if ($current_image) {\r\n      $popup.find('.fr-link-attr[name=\"text\"]').parent().hide() \r\n    }\r\n    else {\r\n      $popup.find('.fr-link-attr[name=\"text\"]').parent().show() \r\n    }\r\n  }\r\n\r\n  function _showInsertPopup() {\r\n    const $btn = editor.$tb.find('.fr-command[data-cmd=\"insertLink\"]') \r\n    let $popup = editor.popups.get('link.insert') \r\n\r\n    if (!$popup) $popup = _initInsertPopup() \r\n\r\n    if (!$popup.hasClass('fr-active')) {\r\n      editor.popups.refresh('link.insert') \r\n      editor.popups.setContainer('link.insert', editor.$tb || editor.$sc) \r\n\r\n      if ($btn.isVisible()) {\r\n        const { left, top } = editor.button.getPosition($btn)      \r\n        editor.popups.show('link.insert', left, top, $btn.outerHeight()) \r\n      }\r\n      else {\r\n        editor.position.forSelection($popup) \r\n        editor.popups.show('link.insert') \r\n      }\r\n    }\r\n  }\r\n\r\n  function _initInsertPopup(delayed) {\r\n    if (delayed) {\r\n      editor.popups.onRefresh('link.insert', _refreshInsertPopup) \r\n\r\n      return true \r\n    }\r\n\r\n    // Image buttons.\r\n    let link_buttons = '' \r\n\r\n    if (editor.opts.linkInsertButtons.length >= 1) {\r\n      link_buttons = `<div class=\"fr-buttons fr-tabs\">${editor.button.buildList(editor.opts.linkInsertButtons)}</div>` \r\n    }\r\n\r\n    const checkmark = '<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"10\" height=\"10\" viewBox=\"0 0 32 32\"><path d=\"M27 4l-15 15-7-7-5 5 12 12 20-20z\" fill=\"#FFF\"></path></svg>' \r\n\r\n    // Image by url layer.\r\n    let input_layer = '' \r\n    let tab_idx = 0 \r\n    input_layer = `<div class=\"fr-link-insert-layer fr-layer fr-active\" id=\"fr-link-insert-layer-${editor.id}\">` \r\n    input_layer += `<div class=\"fr-input-line\"><input id=\"fr-link-insert-layer-url-${editor.id}\" name=\"href\" type=\"text\" class=\"fr-link-attr\" placeholder=\"${editor.language.translate('URL')}\" tabIndex=\"${(++tab_idx)}\"></div>` \r\n\r\n    if (editor.opts.linkText) {\r\n      input_layer += `<div class=\"fr-input-line\"><input id=\"fr-link-insert-layer-text-${editor.id}\" name=\"text\" type=\"text\" class=\"fr-link-attr\" placeholder=\"${editor.language.translate('Text')}\" tabIndex=\"${(++tab_idx)}\"></div>`\r\n    }\r\n\r\n    // Add any additional fields.\r\n    for (const attr in editor.opts.linkAttributes) {\r\n      if (editor.opts.linkAttributes.hasOwnProperty(attr)) {\r\n        const placeholder = editor.opts.linkAttributes[attr] \r\n        input_layer += `<div class=\"fr-input-line\"><input name=\"${attr}\" type=\"text\" class=\"fr-link-attr\" placeholder=\"${editor.language.translate(placeholder)}\" tabIndex=\"${(++tab_idx)}\"></div>` \r\n      }\r\n    }\r\n\r\n    if (!editor.opts.linkAlwaysBlank) {\r\n      input_layer += `<div class=\"fr-checkbox-line\"><span class=\"fr-checkbox\"><input name=\"target\" class=\"fr-link-attr\" data-checked=\"_blank\" type=\"checkbox\" id=\"fr-link-target-${editor.id}\" tabIndex=\"${(++tab_idx)}\"><span>${checkmark}</span></span><label id=\"fr-label-target-${editor.id}\">${editor.language.translate('Open in new tab')}</label></div>`\r\n    }\r\n\r\n    input_layer += `<div class=\"fr-action-buttons\"><button class=\"fr-command fr-submit\" role=\"button\" data-cmd=\"linkInsert\" href=\"#\" tabIndex=\"${(++tab_idx)}\" type=\"button\">${editor.language.translate('Insert')}</button></div></div>`\r\n\r\n    const template = {\r\n      buttons: link_buttons,\r\n      input_layer: input_layer\r\n    }\r\n\r\n    // Set the template in the popup.\r\n    const $popup = editor.popups.create('link.insert', template) \r\n\r\n    if (editor.$wp) {\r\n      editor.events.$on(editor.$wp, 'scroll.link-insert', function () {\r\n        const $current_image = editor.image ? editor.image.get() : null \r\n\r\n        if ($current_image && editor.popups.isVisible('link.insert')) {\r\n          imageLink() \r\n        }\r\n\r\n        if (get && editor.popups.isVisible('link.insert')) {\r\n          update() \r\n        }\r\n      }) \r\n    }\r\n\r\n    return $popup \r\n  }\r\n\r\n  function remove() {\r\n    const link = get() \r\n\r\n    const $current_image = editor.image ? editor.image.get() : null \r\n\r\n    if (editor.events.trigger('link.beforeRemove', [link]) === false) return false \r\n\r\n    if ($current_image && link) {\r\n      $current_image.unwrap() \r\n      editor.image.edit($current_image) \r\n    }\r\n    else if (link) {\r\n      editor.selection.save() \r\n      $(link).replaceWith($(link).html()) \r\n      editor.selection.restore() \r\n      _hideEditPopup() \r\n    }\r\n  }\r\n\r\n  function _init() {\r\n\r\n    // Edit on keyup.\r\n    editor.events.on('keyup', function (e) {\r\n      if (e.which != FE.KEYCODE.ESC) {\r\n        _edit(e) \r\n      }\r\n    }) \r\n\r\n    editor.events.on('window.mouseup', _edit) \r\n\r\n    // Do not follow links when edit is disabled.\r\n    editor.events.$on(editor.$el, 'click', 'a', function (e) {\r\n      if (editor.edit.isDisabled()) {\r\n        e.preventDefault() \r\n      }\r\n    }) \r\n\r\n    if (editor.helpers.isMobile()) {\r\n      editor.events.$on(editor.$doc, 'selectionchange', _edit) \r\n    }\r\n\r\n    _initInsertPopup(true) \r\n\r\n    // Init on link.\r\n    if (editor.el.tagName == 'A') {\r\n      editor.$el.addClass('fr-view') \r\n    }\r\n\r\n    // Hit ESC when focus is in link edit popup.\r\n    editor.events.on('toolbar.esc', function () {\r\n      if (editor.popups.isVisible('link.edit')) {\r\n        editor.events.disableBlur() \r\n        editor.events.focus() \r\n\r\n        return false \r\n      }\r\n    }, true) \r\n  }\r\n\r\n  function usePredefined(val) {\r\n    const link = editor.opts.linkList[val] \r\n    const $popup = editor.popups.get('link.insert') \r\n    const text_inputs = $popup.find('input.fr-link-attr[type=\"text\"]') \r\n    const check_inputs = $popup.find('input.fr-link-attr[type=\"checkbox\"]') \r\n    let $input \r\n    let i \r\n\r\n    // Add rel attribute to the popup if it exists\r\n    // https://github.com/froala-labs/froala-editor-js-2/issues/831\r\n    if (link.rel) {\r\n      $popup.rel = link.rel\r\n    }\r\n\r\n    for (i = 0; i < text_inputs.length; i++) {\r\n      $input = $(text_inputs[i]) \r\n\r\n      if (link[$input.attr('name')]) {\r\n        $input.val(link[$input.attr('name')])\r\n        \r\n        // Mark the input box as non empty for transition\r\n        $input.toggleClass('fr-not-empty', true)\r\n      }\r\n      else if ($input.attr('name') != 'text') {\r\n        $input.val('') \r\n      }\r\n    }\r\n\r\n    for (i = 0; i < check_inputs.length; i++) {\r\n      $input = $(check_inputs[i]) \r\n      $input.attr('checked', $input.data('checked') == link[$input.attr('name')])\r\n    }\r\n    editor.accessibility.focusPopup($popup) \r\n  }\r\n\r\n  function insertCallback() {\r\n    const $popup = editor.popups.get('link.insert') \r\n    const text_inputs = $popup.find('input.fr-link-attr[type=\"text\"]') \r\n    const check_inputs = $popup.find('input.fr-link-attr[type=\"checkbox\"]') \r\n    const href = (text_inputs.filter('[name=\"href\"]').val() || '').trim() \r\n    const text = (editor.opts.linkText) ? text_inputs.filter('[name=\"text\"]').val() : \"\";\r\n    const attrs = {}\r\n    let $input \r\n    let i \r\n\r\n    for (i = 0; i < text_inputs.length; i++) {\r\n      $input = $(text_inputs[i]) \r\n\r\n      if (['href', 'text'].indexOf($input.attr('name')) < 0) {\r\n        attrs[$input.attr('name')] = $input.val() \r\n      }\r\n    }\r\n\r\n    for (i = 0; i < check_inputs.length; i++) {\r\n      $input = $(check_inputs[i]) \r\n\r\n      if ($input.is(':checked')) {\r\n        attrs[$input.attr('name')] = $input.data('checked') \r\n      }\r\n      else {\r\n        attrs[$input.attr('name')] = $input.data('unchecked') || null \r\n      }\r\n    }\r\n\r\n    // check for rel attritube here\r\n    $popup.rel ? attrs.rel = $popup.rel : ''\r\n\r\n    const t = editor.helpers.scrollTop() \r\n    insert(href, text, attrs) \r\n    $(editor.o_win).scrollTop(t) \r\n  }\r\n\r\n  function _split() {\r\n    if (!editor.selection.isCollapsed()) {\r\n      editor.selection.save() \r\n      let markers = editor.$el.find('.fr-marker').addClass('fr-unprocessed').toArray() \r\n\r\n      while (markers.length) {\r\n        const $marker = $(markers.pop()) \r\n        $marker.removeClass('fr-unprocessed') \r\n\r\n        // Get deepest parent.\r\n        const deep_parent = editor.node.deepestParent($marker.get(0)) \r\n\r\n        if (deep_parent) {\r\n          let node = $marker.get(0) \r\n          let close_str = '' \r\n          let open_str = '' \r\n\r\n          do {\r\n            node = node.parentNode \r\n\r\n            if (!editor.node.isBlock(node)) {\r\n              close_str = close_str + editor.node.closeTagString(node) \r\n              open_str = editor.node.openTagString(node) + open_str \r\n            }\r\n          } while (node != deep_parent) \r\n\r\n          const marker_str = editor.node.openTagString($marker.get(0)) + $marker.html() + editor.node.closeTagString($marker.get(0)) \r\n\r\n          $marker.replaceWith('<span id=\"fr-break\"></span>') \r\n          let { outerHTML : h } = deep_parent \r\n\r\n          //  https://github.com/froala/wysiwyg-editor/issues/3048\r\n\r\n          h = h.replace(/<span id=\"fr-break\"><\\/span>/g, close_str + marker_str + open_str) \r\n          h = h.replace(open_str + close_str, '') \r\n\r\n          deep_parent.outerHTML = h \r\n        }\r\n\r\n        markers = editor.$el.find('.fr-marker.fr-unprocessed').toArray() \r\n      }\r\n\r\n\r\n      editor.html.cleanEmptyTags() \r\n\r\n      editor.selection.restore() \r\n    }\r\n  }\r\n\r\n  /**\r\n   * Insert link into the editor.\r\n   */\r\n  function insert(href, text, attrs) {\r\n    if (typeof attrs == 'undefined') attrs = {} \r\n\r\n    if (editor.events.trigger('link.beforeInsert', [href, text, attrs]) === false) return false \r\n\r\n    // Get image if we have one selected.\r\n    const $current_image = editor.image ? editor.image.get() : null \r\n\r\n    if (!$current_image && editor.el.tagName != 'A') {\r\n      editor.selection.restore() \r\n      editor.popups.hide('link.insert') \r\n    }\r\n    else if (editor.el.tagName == 'A') {\r\n      editor.$el.focus() \r\n    }\r\n\r\n    const original_href = href \r\n\r\n    // Convert email address.\r\n    if (editor.opts.linkConvertEmailAddress) {\r\n      if (editor.helpers.isEmail(href) && !/^mailto:.*/i.test(href)) {\r\n        href = `mailto:${href}` \r\n      }\r\n    }\r\n\r\n    // Check if is local path.\r\n    const local_path = /^([A-Za-z]:(\\\\){1,2}|[A-Za-z]:((\\\\){1,2}[^\\\\]+)+)(\\\\)?$/i \r\n\r\n    // Add autoprefix.\r\n    if (editor.opts.linkAutoPrefix !== '' && !new RegExp('^(' + FE.LinkProtocols.join('|') + '):.', 'i').test(href) && !/^data:image.*/i.test(href) && !/^(https?:|ftps?:|file:|)\\/\\//i.test(href) && !local_path.test(href)) {\r\n\r\n      // Do prefix only if starting character is not absolute.\r\n      if (['/', '{', '[', '#', '(', '.'].indexOf((href || '')[0]) < 0) {\r\n        href = editor.opts.linkAutoPrefix + editor.helpers.sanitizeURL(href) \r\n      }\r\n    }\r\n\r\n    // Sanitize the URL.\r\n    href = editor.helpers.sanitizeURL(href) \r\n\r\n    // Default attributs.\r\n    if (editor.opts.linkAlwaysBlank) attrs.target = '_blank' \r\n\r\n    if (editor.opts.linkAlwaysNoFollow) attrs.rel = 'nofollow' \r\n\r\n    if (editor.helpers.isEmail(original_href)) {\r\n      attrs.target = null \r\n      attrs.rel = null \r\n    }\r\n\r\n    // https://github.com/froala/wysiwyg-editor/issues/1576.\r\n    if (attrs.target == '_blank') {\r\n      if (editor.opts.linkNoOpener) {\r\n        if (!attrs.rel) attrs.rel = 'noopener' \r\n        else attrs.rel += ' noopener' \r\n      }\r\n\r\n      if (editor.opts.linkNoReferrer) {\r\n        if (!attrs.rel) attrs.rel = 'noreferrer' \r\n        else attrs.rel += ' noreferrer' \r\n      }\r\n    }\r\n    else if (attrs.target == null) {\r\n      if (attrs.rel) {\r\n        attrs.rel = attrs.rel.replace(/noopener/, '').replace(/noreferrer/, '') \r\n      }\r\n      else {\r\n        attrs.rel = null \r\n      }\r\n    }\r\n\r\n    // Format text.\r\n    text = text || '' \r\n\r\n    if (href === editor.opts.linkAutoPrefix) {\r\n      const $popup = editor.popups.get('link.insert') \r\n      $popup.find('input[name=\"href\"]').addClass('fr-error') \r\n      editor.events.trigger('link.bad', [original_href]) \r\n\r\n      return false \r\n    }\r\n\r\n    // Check if we have selection only in one link.\r\n    const link = get() \r\n    let $link \r\n\r\n    if (link) {\r\n      $link = $(link) \r\n\r\n      $link.attr('href', href) \r\n\r\n      // Change text if it is different.\r\n      if (text.length > 0 && $link.text() != text && !$current_image) {\r\n        let child = $link.get(0) \r\n\r\n        while (child.childNodes.length === 1 && child.childNodes[0].nodeType == Node.ELEMENT_NODE) {\r\n          child = child.childNodes[0] \r\n        }\r\n\r\n        $(child).text(text) \r\n      }\r\n\r\n      if (!$current_image) {\r\n        $link\r\n          .prepend(FE.START_MARKER)\r\n          .append(FE.END_MARKER) \r\n      }\r\n\r\n      // Set attributes.\r\n      // https://github.com/froala-labs/froala-editor-js-2/issues/2023\r\n      for (var prop in attrs) {\r\n        if (!attrs[prop]) {\r\n          $link.removeAttr(prop)\r\n        }\r\n        else {\r\n          $link.attr(prop, attrs[prop])\r\n        }\r\n      }\r\n\r\n      if (!$current_image) {\r\n        editor.selection.restore() \r\n      }\r\n    }\r\n    else {\r\n\r\n      // We don't have any image selected.\r\n      if (!$current_image) {\r\n\r\n        // Remove current links.\r\n        editor.format.remove('a') \r\n        // Nothing is selected.\r\n        if (editor.selection.isCollapsed()) {\r\n          text = (text.length === 0 ? original_href : text) \r\n          editor.html.insert(`<a href=\"${href}\">${FE.START_MARKER}${text.replace(/&/g, '&amp;').replace(/</, '&lt;', '>', '&gt;')}${FE.END_MARKER}</a>`) \r\n          editor.selection.restore() \r\n        }\r\n        else {\r\n          if (text.length > 0 && text != editor.selection.text().replace(/\\n/g, '')) {\r\n            editor.selection.remove() \r\n            editor.html.insert(`<a href=\"${href}\">${FE.START_MARKER}${text.replace(/&/g, '&amp;')}${FE.END_MARKER}</a>`) \r\n            editor.selection.restore() \r\n          }\r\n          else {\r\n            _split() \r\n\r\n            // Add link.\r\n            editor.format.apply('a', { href: href }) \r\n          }\r\n        }\r\n      }\r\n      else {\r\n\r\n        // Just wrap current image with a link.\r\n        $current_image.wrap(`<a href=\"${href}\"></a>`)\r\n\r\n        if (editor.image.hasCaption()) {\r\n          $current_image.parent().append($current_image.parents('.fr-img-caption').find('.fr-inner'))\r\n        }\r\n      }\r\n\r\n      // Set attributes.\r\n      const links = allSelected() \r\n\r\n      for (let i = 0; i < links.length; i++) {\r\n        $link = $(links[i]) \r\n        $link.attr(attrs) \r\n        $link.removeAttr('_moz_dirty') \r\n      }\r\n\r\n      // Show link edit if only one link.\r\n      if (links.length == 1 && editor.$wp && !$current_image) {\r\n        $(links[0])\r\n          .prepend(FE.START_MARKER)\r\n          .append(FE.END_MARKER) \r\n\r\n        editor.selection.restore() \r\n      }\r\n    }\r\n\r\n    // Hide popup and try to edit.\r\n    if (!$current_image) {\r\n      _edit() \r\n    }\r\n    else {\r\n      const $pop = editor.popups.get('link.insert') \r\n\r\n      if ($pop) {\r\n        $pop.find('input:focus').blur() \r\n      }\r\n\r\n      editor.image.edit($current_image) \r\n    }\r\n  }\r\n\r\n  function update() {\r\n    _hideEditPopup() \r\n\r\n    const link = get() \r\n\r\n    if (link) {\r\n      let $popup = editor.popups.get('link.insert') \r\n\r\n      if (!$popup) $popup = _initInsertPopup() \r\n\r\n      if (!editor.popups.isVisible('link.insert')) {\r\n        editor.popups.refresh('link.insert') \r\n        editor.selection.save() \r\n\r\n        if (editor.helpers.isMobile()) {\r\n          editor.events.disableBlur() \r\n          editor.$el.blur() \r\n          editor.events.enableBlur() \r\n        }\r\n      }\r\n\r\n      editor.popups.setContainer('link.insert', editor.$sc) \r\n      const $ref = (editor.image ? editor.image.get() : null) || $(link) \r\n      const left = $ref.offset().left + $ref.outerWidth() / 2\r\n      const top = $ref.offset().top + $ref.outerHeight()\r\n        \r\n      editor.popups.show('link.insert', left, top, $ref.outerHeight(), true) \r\n    }\r\n  }\r\n\r\n  function back() {\r\n    const $current_image = editor.image ? editor.image.get() : null \r\n\r\n    if (!$current_image) {\r\n      editor.events.disableBlur() \r\n      editor.selection.restore() \r\n      editor.events.enableBlur() \r\n\r\n      const link = get() \r\n\r\n      if (link && editor.$wp) {\r\n        editor.selection.restore() \r\n        _hideEditPopup() \r\n        _edit() \r\n      }\r\n      else if (editor.el.tagName == 'A') {\r\n        editor.$el.focus() \r\n        _edit() \r\n      }\r\n      else {\r\n        editor.popups.hide('link.insert') \r\n        editor.toolbar.showInline() \r\n      }\r\n    }\r\n    else {\r\n      editor.image.back() \r\n    }\r\n  }\r\n\r\n  function imageLink() {\r\n    let $el = editor.image ? editor.image.getEl() : null \r\n\r\n    if ($el) {\r\n      let $popup = editor.popups.get('link.insert') \r\n\r\n      if (editor.image.hasCaption()) {\r\n        $el = $el.find('.fr-img-wrap') \r\n      }\r\n\r\n      if (!$popup) $popup = _initInsertPopup() \r\n      _refreshInsertPopup(true) \r\n      editor.popups.setContainer('link.insert', editor.$sc) \r\n      const left = $el.offset().left + ($el.outerWidth()) / 2\r\n      const top = $el.offset().top + $el.outerHeight()\r\n\r\n      editor.popups.show('link.insert', left, top, $el.outerHeight(), true) \r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply specific style.\r\n   */\r\n  function applyStyle(val, linkStyles, multipleStyles) {\r\n    if (typeof multipleStyles == 'undefined') multipleStyles = editor.opts.linkMultipleStyles \r\n\r\n    if (typeof linkStyles == 'undefined') linkStyles = editor.opts.linkStyles \r\n    const link = get() \r\n\r\n    if (!link) return false \r\n\r\n    // Remove multiple styles.\r\n    if (!multipleStyles) {\r\n      const styles = Object.keys(linkStyles) \r\n      styles.splice(styles.indexOf(val), 1) \r\n      $(link).removeClass(styles.join(' ')) \r\n    }\r\n\r\n    $(link).toggleClass(val) \r\n\r\n    _edit() \r\n  }\r\n\r\n  return {\r\n    _init: _init,\r\n    remove: remove,\r\n    showInsertPopup: _showInsertPopup,\r\n    usePredefined: usePredefined,\r\n    insertCallback: insertCallback,\r\n    insert: insert,\r\n    update: update,\r\n    get: get,\r\n    allSelected: allSelected,\r\n    back: back,\r\n    imageLink: imageLink,\r\n    applyStyle: applyStyle\r\n  }\r\n}\r\n\r\n// Register the link command.\r\nFE.DefineIcon('insertLink', { NAME: 'link', SVG_KEY: 'insertLink' })\r\nFE.RegisterShortcut(FE.KEYCODE.K, 'insertLink', null, 'K') \r\nFE.RegisterCommand('insertLink', {\r\n  title: 'Insert Link',\r\n  undo: false,\r\n  focus: true,\r\n  refreshOnCallback: false,\r\n  popup: true,\r\n  callback: function () {\r\n    if (!this.popups.isVisible('link.insert')) {\r\n      this.link.showInsertPopup() \r\n    }\r\n    else {\r\n      if (this.$el.find('.fr-marker').length) {\r\n        this.events.disableBlur() \r\n        this.selection.restore() \r\n      }\r\n      this.popups.hide('link.insert') \r\n    }\r\n  },\r\n  plugin: 'link'\r\n})\r\n\r\nFE.DefineIcon('linkOpen', {\r\n  NAME: 'external-link',\r\n  FA5NAME: 'external-link-alt',\r\n  SVG_KEY: 'openLink'\r\n})\r\nFE.RegisterCommand('linkOpen', {\r\n  title: 'Open Link',\r\n  undo: false,\r\n  refresh: function ($btn) {\r\n    const link = this.link.get() \r\n\r\n    if (link) {\r\n      $btn.removeClass('fr-hidden') \r\n    }\r\n    else {\r\n      $btn.addClass('fr-hidden') \r\n    }\r\n  },\r\n  callback: function () {\r\n    const link = this.link.get() \r\n\r\n    if (link) {\r\n\r\n      if (link.href.indexOf('mailto:') !== -1) {\r\n        this.o_win.open(link.href).close() \r\n      }\r\n      else {\r\n        // Setting the context of the opening link to _self for opening it within window\r\n        if (!link.target) {\r\n          link.target = '_self'\r\n        }\r\n\r\n        if (this.browser.msie || this.browser.edge) {\r\n          // noopener is not supported in IE and EDGE\r\n          this.o_win.open(link.href, link.target)\r\n        }\r\n        else {\r\n          this.o_win.open(link.href, link.target, 'noopener')\r\n        }\r\n      }\r\n\r\n      this.popups.hide('link.edit') \r\n    }\r\n  },\r\n  plugin: 'link'\r\n})\r\n\r\nFE.DefineIcon('linkEdit', { NAME: 'edit', SVG_KEY: 'edit' })\r\nFE.RegisterCommand('linkEdit', {\r\n  title: 'Edit Link',\r\n  undo: false,\r\n  refreshAfterCallback: false,\r\n  popup: true,\r\n  callback: function () {\r\n    this.link.update() \r\n  },\r\n  refresh: function ($btn) {\r\n    const link = this.link.get() \r\n\r\n    if (link) {\r\n      $btn.removeClass('fr-hidden') \r\n    }\r\n    else {\r\n      $btn.addClass('fr-hidden') \r\n    }\r\n  },\r\n  plugin: 'link'\r\n})\r\n\r\nFE.DefineIcon('linkRemove', { NAME: 'unlink', SVG_KEY: 'unlink' })\r\nFE.RegisterCommand('linkRemove', {\r\n  title: 'Unlink',\r\n  callback: function () {\r\n    this.link.remove() \r\n  },\r\n  refresh: function ($btn) {\r\n    const link = this.link.get() \r\n\r\n    if (link) {\r\n      $btn.removeClass('fr-hidden') \r\n    }\r\n    else {\r\n      $btn.addClass('fr-hidden') \r\n    }\r\n  },\r\n  plugin: 'link'\r\n})\r\n\r\nFE.DefineIcon('linkBack', { NAME: 'arrow-left', SVG_KEY: 'back' })\r\nFE.RegisterCommand('linkBack', {\r\n  title: 'Back',\r\n  undo: false,\r\n  focus: false,\r\n  back: true,\r\n  refreshAfterCallback: false,\r\n  callback: function () {\r\n    this.link.back() \r\n  },\r\n  refresh: function ($btn) {\r\n    const link = this.link.get() && this.doc.hasFocus() \r\n    const $current_image = this.image ? this.image.get() : null \r\n\r\n    if (!$current_image && !link && !this.opts.toolbarInline) {\r\n      $btn.addClass('fr-hidden') \r\n      $btn.next('.fr-separator').addClass('fr-hidden') \r\n    }\r\n    else {\r\n      $btn.removeClass('fr-hidden') \r\n      $btn.next('.fr-separator').removeClass('fr-hidden') \r\n    }\r\n  },\r\n  plugin: 'link'\r\n}) \r\n\r\nFE.DefineIcon('linkList', { NAME: 'search', SVG_KEY: 'search' })\r\nFE.RegisterCommand('linkList', {\r\n  title: 'Choose Link',\r\n  type: 'dropdown',\r\n  focus: false,\r\n  undo: false,\r\n  refreshAfterCallback: false,\r\n  html: function () {\r\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">' \r\n    const { linkList : options } = this.opts \r\n\r\n    for (let i = 0; i < options.length; i++) {\r\n      c += `<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"linkList\" data-param1=\"${i}\">${(options[i].displayText || options[i].text)}</a></li>`\r\n    }\r\n    c += '</ul>' \r\n\r\n    return c \r\n  },\r\n  callback: function (cmd, val) {\r\n    this.link.usePredefined(val) \r\n  },\r\n  plugin: 'link'\r\n})\r\n\r\nFE.RegisterCommand('linkInsert', {\r\n  focus: false,\r\n  refreshAfterCallback: false,\r\n  callback: function () {\r\n    this.link.insertCallback() \r\n  },\r\n  refresh: function ($btn) {\r\n    const link = this.link.get() \r\n\r\n    if (link) {\r\n      $btn.text(this.language.translate('Update')) \r\n    }\r\n    else {\r\n      $btn.text(this.language.translate('Insert')) \r\n    }\r\n  },\r\n  plugin: 'link'\r\n})\r\n\r\n// Image link.\r\nFE.DefineIcon('imageLink', { NAME: 'link', SVG_KEY: 'insertLink' })\r\nFE.RegisterCommand('imageLink', {\r\n  title: 'Insert Link',\r\n  undo: false,\r\n  focus: false,\r\n  popup: true,\r\n  callback: function () {\r\n    this.link.imageLink() \r\n  },\r\n  refresh: function ($btn) {\r\n    const link = this.link.get() \r\n    let $prev \r\n\r\n    if (link) {\r\n      $prev = $btn.prev() \r\n\r\n      if ($prev.hasClass('fr-separator')) {\r\n        $prev.removeClass('fr-hidden') \r\n      }\r\n\r\n      $btn.addClass('fr-hidden') \r\n    }\r\n    else {\r\n      $prev = $btn.prev() \r\n\r\n      if ($prev.hasClass('fr-separator')) {\r\n        $prev.addClass('fr-hidden') \r\n      }\r\n\r\n      $btn.removeClass('fr-hidden') \r\n    }\r\n  },\r\n  plugin: 'link'\r\n})\r\n\r\n// Link styles.\r\nFE.DefineIcon('linkStyle', { NAME: 'magic',  SVG_KEY: 'linkStyles' })\r\nFE.RegisterCommand('linkStyle', {\r\n  title: 'Style',\r\n  type: 'dropdown',\r\n  html: function () {\r\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">' \r\n    const options = this.opts.linkStyles \r\n\r\n    for (const cls in options) {\r\n      if (options.hasOwnProperty(cls)) {\r\n        c += `<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"linkStyle\" data-param1=\"${cls}\">${this.language.translate(options[cls])}</a></li>` \r\n      }\r\n    }\r\n    c += '</ul>' \r\n\r\n    return c \r\n  },\r\n  callback: function (cmd, val) {\r\n    this.link.applyStyle(val) \r\n  },\r\n  refreshOnShow: function ($btn, $dropdown) {\r\n\r\n    const { $ } = this\r\n    const link = this.link.get() \r\n\r\n    if (link) {\r\n      const $link = $(link) \r\n\r\n      $dropdown.find('.fr-command').each(function () {\r\n        const cls = $(this).data('param1') \r\n        const active = $link.hasClass(cls) \r\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active) \r\n      })\r\n    }\r\n  },\r\n  refresh: function ($btn) {\r\n    const link = this.link.get() \r\n\r\n    if (link) {\r\n      $btn.removeClass('fr-hidden') \r\n    }\r\n    else {\r\n      $btn.addClass('fr-hidden') \r\n    }\r\n  },\r\n  plugin: 'link'\r\n})"],"names":["Object","assign","FE","POPUP_TEMPLATES","DEFAULTS","linkEditButtons","linkInsertButtons","linkAttributes","linkAutoPrefix","linkStyles","linkMultipleStyles","linkConvertEmailAddress","linkAlwaysBlank","linkAlwaysNoFollow","linkNoOpener","linkNoReferrer","linkList","text","href","target","displayText","linkText","PLUGINS","link","editor","$","get","$current_image","image","$wp","c_el","selection","ranges","commonAncestorContainer","contains","el","ex","tagName","s_el","element","e_el","endElement","node","isElement","parentsUntil","$el","first","browser","msie","helpers","isMobile","info","atEnd","atStart","parentNode","allSelected","selectedLinks","push","range","containerEl","links","linkRange","win","getSelection","sel","getRangeAt","rangeCount","doc","createRange","r","nodeType","nodeName","toLowerCase","getElementsByTagName","i","length","selectNodeContents","compareBoundaryPoints","END_TO_START","START_TO_END","type","parentElement","body","createTextRange","j","moveToElementText","compareEndPoints","_edit","e","core","hasFocus","_hideEditPopup","altKey","which","KEYCODE","ALT","setTimeout","contents","startOffset","endOffset","before","MARKERS","after","restore","stopPropagation","_showEditPopup","isIOS","$popup","popups","_initEditPopup","$link","isVisible","refresh","setContainer","$sc","left","offset","outerWidth","top","outerHeight","show","hide","link_buttons","opts","indexOf","splice","button","buildList","template","buttons","create","events","$on","_refreshInsertPopup","text_inputs","find","check_inputs","$input","val","attr","data","trigger","parent","_showInsertPopup","$btn","$tb","_initInsertPopup","hasClass","getPosition","position","forSelection","delayed","onRefresh","checkmark","input_layer","tab_idx","id","language","translate","hasOwnProperty","placeholder","imageLink","update","remove","unwrap","edit","save","replaceWith","html","_init","on","ESC","isDisabled","preventDefault","$doc","addClass","disableBlur","focus","usePredefined","rel","toggleClass","accessibility","focusPopup","insertCallback","filter","trim","attrs","is","t","scrollTop","insert","o_win","_split","isCollapsed","markers","toArray","$marker","pop","removeClass","deep_parent","deepestParent","close_str","open_str","isBlock","closeTagString","openTagString","marker_str","h","outerHTML","replace","cleanEmptyTags","original_href","isEmail","test","local_path","RegExp","LinkProtocols","join","sanitizeURL","child","childNodes","Node","ELEMENT_NODE","prepend","START_MARKER","append","END_MARKER","prop","removeAttr","format","apply","wrap","hasCaption","parents","$pop","blur","enableBlur","$ref","back","toolbar","showInline","getEl","applyStyle","multipleStyles","styles","keys","showInsertPopup","DefineIcon","NAME","SVG_KEY","RegisterShortcut","K","RegisterCommand","title","undo","refreshOnCallback","popup","callback","plugin","FA5NAME","open","close","edge","refreshAfterCallback","toolbarInline","next","c","options","cmd","$prev","prev","cls","refreshOnShow","$dropdown","each","active"],"mappings":"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"}